!!! 5
html
  head
    meta(name="apple-mobile-web-app-capable", content="yes")
    meta(name="apple-mobile-web-app-status-bar-style", content="black")
    meta(name="viewport", content="width=device-width, height=device-height user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, target-densitydpi=device-dpi")
    title= title
    
    link(rel='stylesheet', href='/stylesheets/testcanvas.css') //temp styling
    link(rel='stylesheet', href='/stylesheets/awwstyle.css') //temp styling
    script(src='/javascripts/paper.js')
    script(src='//code.jquery.com/jquery-latest.min.js')
    script(src='/nowjs/now.js') //this is what allows realtime communication, 

body.background
  div#container
    p#wallid #{wall_id-1}
    .canvas.landscape.aww-crosshair //these clases will be replaced
      h1 #{title}
      nav#toolbar.toolbar
        ul.navigation
          li
            input.tool(type='button',value='Pen')
          li
            input.color(type='button',value='Black')
          li
            input.color(type='button',value='Red')
          li 
            input.color(type='button',value='Green')
          li  
            input.tool(type='button',value='Pan')
          li  
            input.tool(type='button',value='Select')
          li  
            a.quit(href='/walls/')
      .whiteboard
        canvas#myCanvas
  script()
    (function(){
      
      //assuming only 1 layer

      paper.install(window);
      paper.setup('myCanvas');
      var wallId = $('#wallid').hide().html();
      var color = 'black';
     
      //NOW functions
      //populate the canvas
      now.initWall(wallId);
      
      //convert database info into paperjs object
      now.init = function(){
        //go through all elements and rebuild
        paper.view.draw();//refresh canvas
      };
      
      //Start of drawing
      now.startDraw = function(color,width,start,pathname){
        path = newPath();
        path.strokeColor = color;
        path.strokeWidth = width;
        path.add(start);
        path.name = pathname;
      }
      
      now.updateDraw = function(point,pathname,layer){
        paper.project.layers[layer].children[pathname].add(point);
        paper.view.draw(); //refresh canvas
      }

      now.endDraw = function(pathname,layer){
        paper.project.layers[layer].children[pathname].simplify(10);
        paper.view.draw(); //refresh canvas
      }
      //rename from temp name to dbref name
      now.renamePath = function(old,new,layer){
        paper.project.layers[layer].children[old].name = new;
      }
      
      //Tool Definitions

      //Pen Tool
      var pen = new Tool();
      pen.onMouseDown = function(event){
        var path = new Path();
        path.strokeColor = color;
        path.strokeWidth = 2;
        path.add(event.point);
        now.shareStartDraw(wallId,color,width,event.point);
        pen.onMouseDrag = function(dragEvent){
          path.add(dragEvent.point);
          now.shareUpdateDraw = function(wallId,dragEvent.point,paper.project.activeLayer.index);
        }
        pen.onMouseUp = function(mouseUpEvent){
          path.simplify(10);
          now.newPath(wallId,path.segments.toString(),path.strokeColor,path.strokeWidth,function(name){
            path.name = name;
          })
        }
      }

      //Pan Tool
      var pan = new Tool();
      pen.onMouseDown = function(event){}
      pen.onMouseDrag = function(event){}
      pen.onMouseUp = function(event){}

      //Select Tool
      var select = new Tool();
      pen.onMouseDown = function(event){}
      pen.onMouseDrag = function(event){}
      pen.onMouseUp = function(event){}

      //Event listeners

      //Change color;
      $('.color').click(function(){
        color = $(this).val();
      });

      //Change tool
      $('.tool').click(function(){
        var t = $(this).val();
        c = $('#myCanvas').removeClass();
        switch(t){
          case 'pan':
            c.addClass('move');
            pan.activate();
            break;
          case 'pen':
            c.addClass('crosshair');
            pen.activate();
            break;
          case 'select':
            c.addClass('pointer');
            select.activate();
            break; 
        }
      });
    })();

    
