now.ready(function(){function l(){var a="",b=document.getElementById("imageView");if(b.getContext){b.getContext("2d");var a=b.toDataURL("image/png");now.sendImage(a,paper.project.activeLayer.index,view.center,function(b){loadImage(b,view.center,a,function(){paper.view.draw()})})}}function m(){var a=document.getElementById("screen-video"),b=document.getElementById("imageView"),c=b.width,d=b.height,e=b.getContext("2d");e.clearRect(0,0,c,d),e.drawImage(a,0,0,c,d),e.save(),l()}function o(){if(H){console.log("start ss with VC active"),C=z.mediaElement.width,D=z.mediaElement.height,z.mediaElement.width=2*(window.innerWidth/3);var a=window.innerHeight-jQuery("header").height()-4;console.log("new screen h",a),z.mediaElement.height=a,jQuery("#ssarea").height()+jQuery("#videoconf").height(),console.log("screen width: ",window.innerWidth),jQuery("canvas").css("z-index","-1"),jQuery("#screen-content").css({left:window.innerWidth/3})}else{console.log("toolbar height: ",jQuery("header").css("height")),C=z.mediaElement.width,console.log("width:"+z.mediaElement.width+" : "+C),D=z.mediaElement.height,console.log("window w:h - ",window.innerWidth,":",window.innerHeight),console.log("toobar: ",jQuery("header").height()),z.mediaElement.width=window.innerWidth;var a=window.innerHeight-jQuery("header").height()-4;console.log("new screen h",a),z.mediaElement.height=a,jQuery("#ssarea").height()+jQuery("#videoconf").height(),jQuery("canvas").css("z-index","-1"),jQuery("screen-container").css("left","100")}}function q(){jQuery("canvas").css("z-index","1"),jQuery("screen-container").css("z-index","-1")}function r(){jQuery("canvas").css("z-index","-1"),jQuery("screen-container").css("z-index","1")}function F(){document.getElementById("sr-full").disabled=!1,document.getElementById("sr-small").disabled=!0,document.getElementById("sr-plus").onclick=function(){z.mediaElement.width+=50,z.mediaElement.height+=50;var a=jQuery("#ssarea").height()+jQuery("#videoconf").height();jQuery("canvas").css({top:a+"px"})},document.getElementById("sr-minus").onclick=function(){z.mediaElement.width-=50,z.mediaElement.height-=50;var a=jQuery("#ssarea").height()+jQuery("#videoconf").height();jQuery("canvas").css({top:a+"px"})},document.getElementById("sr-full").onclick=function(){console.log("toolbar height: ",jQuery("header").css("height")),C=z.mediaElement.width,console.log("width:"+z.mediaElement.width+" : "+C),D=z.mediaElement.height,z.mediaElement.width=window.innerWidth;var a=window.innerHeight-jQuery("#toobar").height();console.log("new screen h",a),z.mediaElement.height=a;var b=jQuery("#ssarea").height()+jQuery("#videoconf").height();jQuery("canvas").css({top:b+"px"}),document.getElementById("sr-full").disabled=!0,document.getElementById("sr-small").disabled=!1},document.getElementById("sr-small").onclick=function(){console.log("width, height ",C," ",D),z.mediaElement.width=C,z.mediaElement.height=D;var a=jQuery("#ssarea").height()+jQuery("#videoconf").height();jQuery("canvas").css({top:a+"px"}),document.getElementById("sr-full").disabled=!1,document.getElementById("sr-small").disabled=!0},document.getElementById("sCapture").onclick=function(){m()}}function R(){document.getElementById("lv-plus").onclick=function(){localStream.mediaElement.width+=100,localStream.mediaElement.height+=100;var a=jQuery("#ssarea").height()+jQuery("#videoconf").height();jQuery("canvas").css({top:a+"px"})},document.getElementById("lv-minus").onclick=function(){localStream.mediaElement.width-=100,localStream.mediaElement.height-=100;var a=jQuery("#ssarea").height()+jQuery("#videoconf").height();jQuery("canvas").css({top:a+"px"})},document.getElementById("rv-plus").onclick=function(){for(i=0;K.length>i;i++)K[i].mediaElement.width+=100,K[i].mediaElement.height+=100;L=K[i-1].mediaElement.height;var a=jQuery("#ssarea").height()+jQuery("#videoconf").height();jQuery("canvas").css({top:a+"px"})},document.getElementById("rv-minus").onclick=function(){for(i=0;K.length>i;i++)K[i].mediaElement.width-=100,K[i].mediaElement.height-=100;L=K[i-1].mediaElement.height;var a=jQuery("#ssarea").height()+jQuery("#videoconf").height();jQuery("canvas").css({top:a+"px"})}}function V(a){if(a&&"undefined"!=typeof FileReader&&/image/i.test(a.type)){var b=new FileReader;b.onload=function(b){a.src=b.target.result,now.sendFile(a,paper.project.activeLayer.index,view.center,function(b){loadImage(b,view.center,a.src,function(){})})},b.readAsDataURL(a)}}if(wallInit)wallInit=!1;else{for(i=0;paper.project.layers.length>i;i++)paper.project.layers[i].removeChildren();jQuery("#users").find("ul").empty()}now.wallId=wallId,now.name=name,now.companyId=companyId,now.browser=$.ua.browser.name,now.bversion=$.ua.browser.version,"undefined"!=typeof boxID&&(now.boxID=boxID,now.register(function(a,b){if(a)for(i=0;a.length>i;i++)jQuery("#shareTo").find("[data-value="+a[i]+"]").children("i").addClass("icon-ok");if(b)for(i=0;b.length>i;i++)jQuery("#walls").find("ul").append('<li class="'+b[i].id+'"><a href="/connect/'+b[i].id+'">'+b[i].name+"</a></li>")}));var e,a=0,b="black",d=6,f=[],g=0,h=new Worker("/javascripts/worker.js");h.addEventListener("message",function(a){S.path.add(a.data),now.shareUpdateDraw(a.data,paper.project.activeLayer.index)},!1);var j=function(a){var b=Array();x=a;for(y in x){var c={point:{},handleIn:{},handleOut:{}};c.point.x=x[y]._point._x,c.point.y=x[y]._point._y,c.handleIn.x=x[y]._handleIn._x,c.handleIn.y=x[y]._handleIn._y,c.handleOut.x=x[y]._handleOut._x,c.handleOut.y=x[y]._handleOut._y,b.push(JSON.stringify(c))}return b};gAlert=function(a){jQuery('<div class="alert fade in">'+a+"</div>").appendTo("#alerts").delay(2e3).slideUp(300,function(){$(this).detach()})},exportCanvas=function(){var e,a=document.getElementById("myCanvas"),b=a.getContext("2d"),c=a.width,d=a.height,f=b.globalCompositeOperation;e=b.getImageData(0,0,c,d),b.globalCompositeOperation="destination-over",b.fillStyle="white",b.fillRect(0,0,c,d),b.globalCompositeOperation=f,a.toBlob(function(a){saveAs(a,wallId+".png")})},updateDelete=function(){var a=(U.target.item.bounds.topLeft.x-paper.view.bounds.topLeft.x+U.target.item.bounds.width)*paper.view.zoom+g,b=(U.target.item.bounds.topLeft.y-paper.view.bounds.topLeft.y)*paper.view.zoom;jQuery("button").filter(".delete-object").css({left:a,top:b})},scrollNav=function(){console.log("scrollNav"),c.addClass("nav"),nw.show();var a=paper.view.bounds.top,b=paper.view.bounds.right,d=paper.view.bounds.bottom,e=paper.view.bounds.left,f=Math.floor(paper.project.activeLayer.bounds.top)-20,g=Math.ceil(paper.project.activeLayer.bounds.right)+20,h=Math.ceil(paper.project.activeLayer.bounds.bottom)+20,i=Math.floor(paper.project.activeLayer.bounds.left)-20,j=Math.min(a,f),k=Math.max(b,g),l=Math.max(d,h),m=Math.min(e,i),n=paper.view.bounds.width,o=paper.view.bounds.height,p=k-m,q=l-j,r=p/200,s=q/150,u={top:!1,left:!1};jQuery("#view").width(n/r).height(o/s).css({top:(a-j)/s,left:(e-m)/r}).draggable({containment:"parent",drag:function(a,b){u.left===!1&&u.top===!1&&(u.left=b.originalPosition.left,u.top=b.originalPosition.top),offsetLeft=b.position.left-u.left,offsetTop=b.position.top-u.top,u.left=b.position.left,u.top=b.position.top,T.v=new Point,T.v.x=offsetLeft*r*paper.view.zoom,T.v.y=offsetTop*s*paper.view.zoom,paper.view.scrollBy(T.v),paper.view.draw()},stop:function(){u.left=!1,u.top=!1}})},loadImage=function(a,b,c,d){var e=document.createElement("img");e.src=c,e.onload=function(){raster=new Raster(e),raster.name=a,raster.position=b,paper.view.draw(),d()}},loadPoints=function(a,b){points=Array();for(n in a.description)points.push(JSON.parse(a.description[n]));var c=new Path(points);c.strokeColor=a.color,c.strokeWidth=a.width,c.opacity=a.opacity,c.name=a._id,b()};var u,z,C,D,s=!1,t=!1,v=!1,w=!1,A=200,B=200,E=new RTCMultiConnection(wallId+"screen");E.session="only-screen",E.direction="one-way",E.onNewSession=function(a){console.log("onNewSession-screen: ",a),s||(jQuery("#ssarea").append('<section id="screen-container"></section><div id="container" style="border:none"><canvas id="imageView" style="display:none; left: 0; top: 0; z-index: 0;border:none" width="1300" height="731"></canvas></div>'),u=a,E.join(a),t=!0,jQuery("#ssShare").html("<h4>Close</h4>")),u=a},E.onstream=function(a){console.log("Screen onstream:",a);var b=document.createElement("div");b.className="screen-container",b.id="screen-content",b.appendChild(a.mediaElement),a.mediaElement.id="screen-video","local"===a.type&&(z=a,document.getElementById("screen-container").appendChild(b),a.mediaElement.width=A,a.mediaElement.height=B),"remote"===a.type&&(z=a,document.getElementById("screen-container").appendChild(b),a.mediaElement.width=A,a.mediaElement.height=B),o(),v=!0},E.onUserLeft=function(a){console.log("Left - userid: ",a),jQuery("#ssarea").empty(),jQuery("canvas").css({top:"0px"}),t=!1,jQuery("#ssShare").html("<h4>Share Screen</h4>")},jQuery("#ShareScreen li").click(function(){var b=jQuery(this);switch(cl=b.attr("data-value")){case"ssShare":if(t)E.leave(),q(),jQuery("#ssarea").empty(),t=!1,jQuery("#ssShare").html("<h4>Share Screen</h4>");else{var c=!1,d=" ";for(console.log("usernames length: ",f.length),i=0;f.length>i;i++)console.log("name: "+f[i].name+" browser: "+f[i].browser),"Chrome"!=f[i].browser&&(c=!0,d=d+f[i].name+" , ");if(c){window.alert("Chrome is needed for this function.  The following people are using a browser other than Chrome: "+d);break}console.log("Open Screen"),jQuery("#ssarea").append('<section id="screen-container"></section><div id="container" style="border:none"><canvas id="imageView" style="display:none; left: 0; top: 0; z-index: 0;border:none" width="1300" height="731"></canvas></div>'),jQuery("#ssarea").height()+jQuery("#videoconf").height(),E.open(wallId+"screen"),s=!0,t=!0,jQuery("#ssShare").html("<h4>Close</h4>"),now.actionMeeting(wallId,name,"goSS")}break;case"ssSize":v?(q(),jQuery("#ssSize").html("<h4>Show</h4>"),v=!1):(r(),jQuery("#ssSize").html("<h4>Hide</h4>"),v=!0);break;case"ssCapture":w?(r(),jQuery("#ssCapture").html("<h4>Capture</h4>"),w=!1,now.sendScreenCapture("release")):(q(),m(),jQuery("#ssCapture").html("<h4>Release</h4>"),w=!0,now.sendScreenCapture("capture"),now.actionMeeting(wallId,name,"goSSCapture"))}}),now.screenCapture=function(a){"capture"==a?(q(),jQuery("#ssCapture").html("<h4>Release</h4>"),w=!0):"release"==a&&(r(),jQuery("#ssCapture").html("<h4>Capture</h4>"),w=!1)},openCloseSS=function(){if(t)jQuery("canvas").css({top:0}),jQuery("#ssarea").empty(),E.leave(),t=!1;else{console.log("Open Screen"),jQuery("#ssarea").append('<p>Screen <button id="sr-plus">+</button> <button id="sr-minus">-</button>   <button id="sr-full">Full Screen</button> <button id="sr-small">Small</button>   <button id="sCapture" style="width: 64px;border:solid 2px #ccc;">Capture</button><section id="screen-container"></section><div id="container" style="border:none"><canvas id="imageView" style="display:none; left: 0; top: 0; z-index: 0;border:none" width="700" height="500"></canvas></div>');var a=jQuery("#ssarea").height()+jQuery("#videoconf").height();jQuery("canvas").css({top:a+"px"}),F(),E.open(wallId+"screen"),s=!0,t=!0}};var I,G=!1,H=!1,K=Array(),L=200,Q=new RTCMultiConnection(wallId+"VC");Q.session="audio + video",sizeVideo=function(){var a,b,c=$(window).width()/3,d=$(window).height()-jQuery("#toolbar").height(),e=K.length;if(0!=e){for(a=d/(e+1),b=1.7778*a,b>c&&(b=c,a=b/1.7778),i=0;K.length>i;i++)K[i].mediaElement.width=b,K[i].mediaElement.height=a;localStream.mediaElement.width=b/2,localStream.mediaElement.height=a/2,g=b+10,jQuery("canvas").css({left:b+10})}},Q.onNewSession=function(a){if(console.log("onNewSession-VC: ",a),!G){jQuery("#videoconf").append('<section id="remote-videos-container"></section><section id="local-video-container"></section>'),jQuery("#ssarea").height()+jQuery("#videoconf").height();var c=$(window).width()/2;jQuery("canvas").css({left:c}),I=a,Q.join(a)}I=a},Q.onstream=function(a){console.log("Video onstream:",a);var b=document.createElement("div");if(b.className="video-container",b.id=a.userid,console.log("stream id: ",a.userid),b.appendChild(a.mediaElement),"local"===a.type){localStream=a,document.getElementById("local-video-container").appendChild(b);var c=$(window).width()/2;a.mediaElement.width=c/2,a.mediaElement.height=c/2/1.7778,sizeVideo(),jQuery("#ssarea").height()+jQuery("#videoconf").height()}if("remote"===a.type){K.push(a);var e=document.getElementById("remote-videos-container");e.appendChild(b,e.firstChild);var f=3*($(window).width()/2)/4;a.mediaElement.width=f,a.mediaElement.height=f/1.7778,sizeVideo(),jQuery("#ssarea").height()+jQuery("#videoconf").height(),H=!0,jQuery("#vcCall").html("<h4>HangUp</h4>")}},Q.onUserLeft=function(a){console.log("Left - userid: ",a);var b=document.getElementById(a);b&&b.parentNode.removeChild(b)},jQuery("#vconf li").click(function(){var b=jQuery(this);switch(cl=b.attr("data-value")){case"vcCall":if(H)jQuery("canvas").css({top:0,left:0}),jQuery("#videoconf").empty(),Q.leave(),H=!1,jQuery("#vcCall").html("<h4>Call</h4>"),g=0;else{var c=!1,d=" ";for(console.log("usernames length: ",f.length),i=0;f.length>i;i++)console.log("name: "+f[i].name+" browser: "+f[i].browser),"Chrome"!=f[i].browser&&(c=!0,d=d+f[i].name+" , ");if(c){window.alert("Chrome is needed for this function.  The following people are using a browser other than Chrome: "+d);break}console.log("Open VC"),jQuery("#videoconf").append('<section id="remote-videos-container"></section><section id="local-video-container"></section>'),jQuery("#ssarea").height()+jQuery("#videoconf").height();var h=$(window).width()/2;g=h,jQuery("canvas").css({left:h}),Q.open(wallId+"VC"),G=!0,H=!0,jQuery("#vcCall").html("<h4>HangUp</h4>"),now.actionMeeting(wallId,name,"goVC")}break;case"vcFull":break;case"vcSplit":}}),openCloseVC=function(){H?(jQuery("canvas").css({top:0,left:0}),jQuery("#videoconf").empty(),Q.leave(),H=!1):(console.log("Open VC"),jQuery("#videoconf").append('<p>Local<button id="lv-plus">+</button> <button id="lv-minus">-</button> Remote   <button id="rv-plus">+</button> <button id="rv-minus">-</button><section id="local-video-container"></section><section id="remote-videos-container"></section>'),jQuery("#ssarea").height()+jQuery("#videoconf").height(),jQuery("canvas").css({left:300}),R(),Q.open(wallId+"VC"),G=!0,H=!0)},pptListClose=function(){$("#pptList").modal("hide")},pptUploadClose=function(){$("#pptUpload").modal("hide")},viewerOpen=function(a,b){$("#pptList").modal("hide"),$("#pptLoad").modal(),console.log("ViewerOpen - doc: "+a+" key: "+b),e=scribd.Document.getDoc(a,b);var c=function(){$("#pptLoad").modal("hide"),$("#pptShow").modal(),console.log("DocReady - Pages:"+e.api.getPageCount())};e.addParam("jsapi_version",2),e.addEventListener("docReady",c),e.addParam("height",470),e.addParam("width",560),e.addParam("mode","slide"),e.write("embedded_doc"),now.sendViewerOpen(a,b)},viewerClose=function(){$("#pptShow").modal("hide"),now.sendViewerClose()},viewerNext=function(){var a=e.api.getPageCount(),b=parseInt(e.api.getPage());a>b&&e.api.setPage(b+1),now.sendViewerNext()},viewerPrev=function(){var a=parseInt(e.api.getPage());a>1&&e.api.setPage(a-1),now.sendViewerPrev()},viewerBegin=function(){e.api.setPage(1),now.sendViewerBegin()},now.viewerOpen=function(a,b){$("#pptLoad").modal(),e=scribd.Document.getDoc(a,b);var c=function(){$("#pptLoad").modal("hide"),$("#pptShow").modal(),console.log("DocReady")};e.addParam("jsapi_version",2),e.addEventListener("docReady",c),e.addParam("height",470),e.addParam("width",560),e.addParam("mode","slide"),e.write("embedded_doc")},now.viewerClose=function(){$("#pptShow").modal("hide")},now.viewerNext=function(){var a=e.api.getPageCount(),b=parseInt(e.api.getPage());a>b&&e.api.setPage(b+1)},now.viewerPrev=function(){var a=parseInt(e.api.getPage());a>1&&e.api.setPage(a-1)},now.viewerBegin=function(){e.api.setPage(1)},now.addFiles=function(a,b,c){console.log("fName: "+a+" fId: "+b+" key: "+c),jQuery("#presList").append('<tr class="'+b+'"><td>'+a+"</td><td>Processing ...</td> </tr>")},now.enableView=function(a,b,c){console.log("enableView-fName: "+a+" fId: "+b+" key: "+c),sClass="."+b,jQuery(sClass).remove(),jQuery("#presList").append('<tr class="'+b+'"><td>'+a+'</td><td><a onclick="javascript:viewerOpen('+b+",'"+c+'\')" class="btn btn-primary">View</a></td> </tr>')},now.pushUser=function(a,b,c,d){jQuery("#users").find("ul").append('<li class="'+b+'">'+a+"</li>"),gAlert(a+" Has Joined"),f.push({name:a,id:b,browser:c,bversion:d})},now.pullUser=function(a,b){users=jQuery("#users").find("."+b),users.length&&(jQuery(users).detach(),gAlert(a+" Has Left")),(i=f.indexOf("clientId"))&&f.splice(i)},now.initWall(function(a,b){if(a){var c=a.paths.length,d=function(b){if(c>b){var e=a.paths[b];paper.project.layers[e.layer]||new Layer,paper.project.layers[e.layer].activate(),e.description.file?loadImage(e._id,e.description.position,e.description.file,function(){paper.view.draw(),d(++b)}):loadPoints(e,function(){paper.view.draw(),d(++b)})}};d(0)}for(i=0;b.length>i;i++)jQuery("#users").find("ul").append('<li class="'+b[i].id+'">'+b[i].name+"</li>"),f.push({name:b[i].name,id:b[i].id,browser:b[i].browser,bversion:b[i].bversion});paper.view.draw()}),now.quit=function(){window.location=jQuery(".navbar").find(".quit").attr("href")},now.share=function(a,b){jQuery("#walls").find("ul").append('<li class="'+a+'"><a href="/connect/'+a+'">'+b+"</a></li>"),gAlert(b+" Has shared a wall with you")},now.unshare=function(a){console.log(a),jQuery("#walls").find("."+a).detach()},now.sharedTo=function(){jQuery("#shareTo").find("[value="+k+"]").addClass("active")},now.startDraw=function(a,b,c,d,e){paper.project.layers[e]||new Layer,paper.project.layers[e].activate(),path=new Path,path.strokeColor=a,path.strokeWidth=b,path.add(c),path.name=d},now.updateDraw=function(b,c,d){paper.project.layers[d].children[c].add(b),a++,(a=4)&&(a=0,paper.view.draw())},now.endDraw=function(a,b,c){paper.project.layers[a].children[b].simplify(),paper.project.layers[a].children[b].name=c,paper.view.draw()},now.updateMove=function(a,b,c){paper.project.layers[a].children[b].selected&&updateDelete(),paper.project.layers[a].children[b].position.x+=c.x,paper.project.layers[a].children[b].position.y+=c.y,paper.view.draw()},now.removePath=function(a,b){paper.project.layers[a].children[b].remove(),paper.view.draw()},now.tError=function(a){alert(a)},tool.distanceThreshhold=10;var S=new Tool;S.onMouseDown=function(a){S.path=new Path,S.path.strokeColor=b,S.path.strokeWidth=d,S.path.add(a.point),now.shareStartDraw(b,d,a.point,paper.project.activeLayer.index)},S.onMouseUp=function(){var c=new Rectangle(S.path.bounds);c.point.x=c.point.x-10,c.point.y=c.point.y-10,c.width=c.width+20,c.height=c.height+20,S.path.simplify(),c.contains(S.path.bounds)||now.serverLog("onMouseUp: Simplified path exceeds bounds"),x=S.path.segments,1==x.length;var d=j(x);now.newPath(d,b,S.path.strokeWidth,paper.project.activeLayer.index,function(a){S.path.name=a})},S.onMouseDrag=function(a){h.postMessage(a.point)};var T=new Tool;T.onMouseDrag=function(a){T.v=new Point,T.v.x=-a.delta.x,T.v.y=-a.delta.y,paper.view.scrollBy(T.v)},T.onMouseUp=function(){paper.view.draw()},window.oncontextmenu=function(a){return a.preventDefault(),a.stopPropagation(),!1};var U=new Tool;U.onMouseDown=function(a){if(U.target&&(U.target.item.selected=!1,jQuery("button").filter(".delete-object").detach()),U.target=project.hitTest(a.point,{stroke:!0,segments:!0,tolerance:2}),U.target){var b=(U.target.item.bounds.topLeft.x-paper.view.bounds.topLeft.x+U.target.item.bounds.width)*paper.view.zoom+g,c=(U.target.item.bounds.topLeft.y-paper.view.bounds.topLeft.y)*paper.view.zoom;U.target.item.selected=!0,jQuery("canvas").after('<button onClick="" class="close delete-object" style="position:absolute;left:'+b+"px;top:"+c+'px;">&times;</button>')}},U.onMouseDrag=function(a){U.target&&(U.target.item.position.x+=a.delta.x,U.target.item.position.y+=a.delta.y,now.sendMoveItem(paper.project.activeLayer.index,U.target.item.name,a.delta),paper.view.draw(),updateDelete())},U.onMouseUp=function(){if(U.target){x=U.target.item.segments;var b=!1;if(void 0===x){b=!0;var c={x:U.target.item.position._x,y:U.target.item.position._y}}else var c=j(x);now.updatePath(U.target.item.name,b,c)}},jQuery(document).keydown(function(a){switch(a.which){case 80:jQuery(".tool[value=Pen]").click();break;case 46:a.preventDefault(),jQuery(".delete-object").click();break;case 67:jQuery(".tool[value=Center]").click(),console.log("center");break;case 83:jQuery(".tool[value=Select]").click();break;case 37:updateDelete(),paper.view.scrollBy({x:-10,y:0}),paper.view.draw();break;case 38:updateDelete(),paper.view.scrollBy({x:0,y:-10}),paper.view.draw();break;case 39:updateDelete(),paper.view.scrollBy({x:10,y:0}),paper.view.draw();break;case 40:updateDelete(),paper.view.scrollBy({x:0,y:10}),paper.view.draw()}}),jQuery(document).on("click",".delete-object",function(){name=U.target.item.name,U.target.item.remove()&&(jQuery("button").filter(".delete-object").detach(),paper.view.draw()),now.sendDeleteItem(paper.project.activeLayer.index,name)}),jQuery("#shareTo li").click(function(a){a.stopImmediatePropagation();var b=jQuery(this);cl=b.attr("data-value"),1>b.find(".icon-ok").length&&(now.shareWall(cl),b.find("i").addClass("icon-ok"))}),jQuery("#toolbar").add("#navWindow").add("#functions").click(function(a){var d=jQuery(a.target);jQuery(".btn-info").removeClass("btn-info");var e=d.attr("value"),f=d.attr("class");if(c=jQuery("#myCanvas").removeClass(),"navWindow"!=a.currentTarget.id&&(nw=jQuery("#navWindow").hide()),U.target&&(U.target.item.selected=!1,jQuery("button").filter(".delete-object").detach(),paper.view.draw()),/.*tool.*/.test(f))switch(e){case"Nav":scrollNav();break;case"ZoomOut":paper.view.zoom=paper.view.zoom/2,scrollNav();break;case"ZoomIn":paper.view.zoom=2*paper.view.zoom,scrollNav();break;case"Pen":d.addClass("btn-info"),c.addClass("crosshair"),S.activate();break;case"Select":d.addClass("btn-info"),c.addClass("pointer"),U.activate();break;case"Center":var g=paper.project.activeLayer.bounds.center,h=paper.view.center,i=new Point(g.x-h.x,g.y-h.y);view.scrollBy(i),view.draw(),scrollNav();break;case"Export":exportCanvas();break;case"Show":$("#pptList").modal();break;case"Vconf":break;case"ShareScreen":break;case"Upload":$("#pptUpload").modal()}else if(/.*color.*/.test(f))b=e,jQuery(".tool[value=Pen]").click();else if(/.*share.*/.test(f))switch(e){case"Share":break;case"Shared":break;case"Users":}else/.*clear.*/.test(f)&&now.clear(function(){return!0})}),now.receiveFilesCanvas=function(a,b,c,d){var e=document.createElement("img");e.src=b,nposition={x:c._x,y:c._y},paper.project.layers[a].activate(),loadImage(d,nposition,b,function(){})},jQuery("#myCanvas").on("drop",function(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.dataTransfer.files[0];V(b),now.actionMeeting(wallId,name,"goEImg")}),jQuery(".tool[value=Pen]").click()}),shareLinkOpen=function(){$("#shareLink").modal()},shareLinkClose=function(){$("#shareLink").modal("hide")};